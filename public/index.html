<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Supermarket</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:900,700,600,400,300">
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

	<link rel="stylesheet" type="text/css" href="assets/style/reset.css">
	<link rel="stylesheet" type="text/css" href="assets/style/fonts/galano/galano.css">
	<link rel="stylesheet" type="text/css" href="assets/style/fonts/icon-12/icon-12.css">
	<link rel="stylesheet" type="text/css" href="assets/style/fonts/icon-16/icon-16.css">
	<link rel="stylesheet" type="text/css" href="assets/style/main.css">
	<link rel="stylesheet" type="text/css" href="assets/style/cards.css">

</head>
<body id="products" class="white">

	<header>
		<div class="logo">
			<img src="assets/style/images/apple.svg" />
		</div>
	</header>

	<main class="main-content">

		<div class="tab-filter-wrapper">
			<div class="tab-filter">
				<ul class="filters">
					<li class="filter">
						<a data-menutype="" href="javascript:void(0);" onclick="filter('');">All</a>
					</li>
					<li class="filter">
						<a data-menutype="bakery" href="javascript:void(0);" onclick="filter('bakery');">Bakery</a>
					</li>
					<li class="filter">
						<a data-menutype="dairy" href="javascript:void(0);" onclick="filter('dairy');">Dairy</a>
					</li>
					<li class="filter">
						<a data-menutype="fruit" href="javascript:void(0);" onclick="filter('fruit');">Fruit</a>
					</li>
					<li class="filter">
						<a data-menutype="vegetable" href="javascript:void(0);" onclick="filter('vegetable');">Vegetable</a>
					</li>
					<li class="filter">
						<a data-menutype="meat" href="javascript:void(0);" onclick="filter('meat');">Meat</a>
					</li>
				</ul>
			</div>
		</div>

		<section class="gallery">
			<ul id="productList"></ul>
			<div class="fail-message">No products found</div>
		</section>

	</main>
		
	<script src="http://cdn.wedeploy.com/api/latest/wedeploy.js"></script>
	<script>
		if (WeDeploy.auth().currentUser === null) {
			location.href = 'login.html';
		}

		function filter(type) {
			var data = WeDeploy.data('data.supermarket.wedeploy.io');
			if (type) {
				data.where('type', type);
			}
			data
				.get('products')
				.then(function(products) {
					var html = '';
					var list = document.getElementById('productList');
					for(var i = 0; i < products.length; i++) {
						html += '<li class="mix ' + products[i].type + '" data-title="' + products[i].title + '">';
						html += '<a href="javascript:;" class="add-to-cart" data-id="' + products[i].id + '" data-price="' + products[i].price + '" data-image="assets/images/' + products[i].filename + '" data-name="' + products[i].title + '">Add To Cart</a>';
						html += '<div class="bottom-info">';
						html += '<span class="title">' + products[i].title + '</span>';
						html += '<span class="price">$' + products[i].price + '</span>';
						html += '</div>';
						html += '<div class="blur"></div>';
						html += '<img src="assets/images/' + products[i].filename + '" alt="' + products[i].description + '" />';
						html += '</li>';
					}
					list.innerHTML = html;
					selectActiveMenu(type);
				});

			return false;
		}

		function selectActiveMenu(type) {
			document.querySelectorAll('[data-menutype]')
				.forEach(function(menu) {
					menu.classList.remove('selected');
					if (menu.dataset.menutype === type) {
						menu.classList.add('selected');
					}
				});
		}

		function signOut() {
			WeDeploy.auth()
				.signOut()
				.then(function() {
					location.href = 'login.html';
				});
		}

		filter('');
	</script>
</body>
</html>
